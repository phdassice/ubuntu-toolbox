#!/bin/bash

# Ubuntu Toolbox - ç³»çµ±ç®¡ç†å·¥å…·é›†
# ä½œè€…: phdassice
# ç‰ˆæœ¬: 1.0.0

set -e

# é¡è‰²å®šç¾©
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# é¡¯ç¤ºæ¨™é¡Œ
show_header() {
    clear
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘                    ${YELLOW}Ubuntu å·¥å…·ç®±${CYAN}                          â•‘${NC}"
    echo -e "${CYAN}â•‘                    ${GREEN}v1.0.0${CYAN}                                â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo
}

# é¡¯ç¤ºä¸»èœå–®
show_menu() {
    echo -e "${BLUE}è«‹é¸æ“‡è¦åŸ·è¡Œçš„åŠŸèƒ½ï¼š${NC}"
    echo
    echo -e "${GREEN}1.${NC} Docker Dangling Images æ¸…ç†"
    echo -e "${GREEN}2.${NC} ç³»çµ±ç‹€æ…‹æŸ¥è©¢"
    echo -e "${GREEN}3.${NC} ç¶²è·¯é€Ÿåº¦æ¸¬è©¦"
    echo -e "${GREEN}4.${NC} ç³»çµ±è³‡è¨Šç¸½è¦½"
    echo -e "${RED}0.${NC} é€€å‡ºå·¥å…·ç®±"
    echo
    echo -n -e "${YELLOW}è«‹è¼¸å…¥é¸é … [0-4]: ${NC}"
}

# æª¢æŸ¥ Docker æ˜¯å¦å®‰è£
check_docker() {
    if ! command -v docker &> /dev/null; then
        echo -e "${RED}éŒ¯èª¤: Docker æœªå®‰è£æˆ–ä¸åœ¨ PATH ä¸­${NC}"
        echo -e "${YELLOW}è«‹å…ˆå®‰è£ Docker å†ä½¿ç”¨æ­¤åŠŸèƒ½${NC}"
        return 1
    fi
    
    if ! docker info &> /dev/null; then
        echo -e "${RED}éŒ¯èª¤: Docker daemon æœªé‹è¡Œæˆ–æ¬Šé™ä¸è¶³${NC}"
        echo -e "${YELLOW}è«‹ç¢ºä¿ Docker æœå‹™æ­£åœ¨é‹è¡Œï¼Œä¸¦ä¸”æ‚¨æœ‰åŸ·è¡Œ Docker çš„æ¬Šé™${NC}"
        return 1
    fi
    return 0
}

# Docker Dangling Images æ¸…ç†
cleanup_docker_images() {
    show_header
    echo -e "${BLUE}=== Docker Dangling Images æ¸…ç† ===${NC}"
    echo
    
    if ! check_docker; then
        echo
        read -p "æŒ‰ä»»æ„éµè¿”å›ä¸»èœå–®..." -n1 -s
        return
    fi
    
    echo -e "${YELLOW}æ­£åœ¨æª¢æŸ¥ dangling images...${NC}"
    
    # ç²å– dangling images
    dangling_images=$(docker images -f "dangling=true" -q)
    
    if [ -z "$dangling_images" ]; then
        echo -e "${GREEN}âœ“ æ²’æœ‰æ‰¾åˆ° dangling imagesï¼Œç³»çµ±å·²ç¶“å¾ˆä¹¾æ·¨äº†ï¼${NC}"
    else
        echo -e "${YELLOW}æ‰¾åˆ°ä»¥ä¸‹ dangling images:${NC}"
        docker images -f "dangling=true"
        echo
        
        read -p "ç¢ºå®šè¦åˆªé™¤é€™äº› dangling images å—? [y/N]: " confirm
        if [[ $confirm =~ ^[Yy]$ ]]; then
            echo -e "${YELLOW}æ­£åœ¨æ¸…ç† dangling images...${NC}"
            
            # è¨˜éŒ„æ¸…ç†å‰çš„ç©ºé–“
            space_before=$(df -h / | awk 'NR==2 {print $4}')
            
            # æ¸…ç† dangling images
            docker rmi $(docker images -f "dangling=true" -q) 2>/dev/null || echo -e "${YELLOW}æŸäº›æ˜ åƒå¯èƒ½æ­£åœ¨ä½¿ç”¨ä¸­${NC}"
            
            # è¨˜éŒ„æ¸…ç†å¾Œçš„ç©ºé–“
            space_after=$(df -h / | awk 'NR==2 {print $4}')
            
            echo -e "${GREEN}âœ“ Dangling images æ¸…ç†å®Œæˆï¼${NC}"
            echo -e "${CYAN}æ¸…ç†å‰å¯ç”¨ç©ºé–“: $space_before${NC}"
            echo -e "${CYAN}æ¸…ç†å¾Œå¯ç”¨ç©ºé–“: $space_after${NC}"
        else
            echo -e "${YELLOW}å–æ¶ˆæ¸…ç†æ“ä½œ${NC}"
        fi
    fi
    
    echo
    echo -e "${BLUE}æ˜¯å¦è¦åŸ·è¡Œå®Œæ•´çš„ Docker ç³»çµ±æ¸…ç†ï¼Ÿ${NC}"
    read -p "é€™å°‡æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„å®¹å™¨ã€ç¶²è·¯ã€æ˜ åƒå’Œæ§‹å»ºç·©å­˜ [y/N]: " full_cleanup
    if [[ $full_cleanup =~ ^[Yy]$ ]]; then
        echo -e "${YELLOW}æ­£åœ¨åŸ·è¡Œå®Œæ•´ç³»çµ±æ¸…ç†...${NC}"
        docker system prune -a --volumes -f
        echo -e "${GREEN}âœ“ Docker ç³»çµ±æ¸…ç†å®Œæˆï¼${NC}"
    fi
    
    echo
    read -p "æŒ‰ä»»æ„éµè¿”å›ä¸»èœå–®..." -n1 -s
}

# ç³»çµ±ç‹€æ…‹æŸ¥è©¢
system_status() {
    show_header
    echo -e "${BLUE}=== ç³»çµ±ç‹€æ…‹æŸ¥è©¢ ===${NC}"
    echo
    
    # ç³»çµ±åŸºæœ¬ä¿¡æ¯
    echo -e "${GREEN}ğŸ“‹ ç³»çµ±è³‡è¨Š:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "ä½œæ¥­ç³»çµ±: $(lsb_release -d | cut -f2)"
    echo "æ ¸å¿ƒç‰ˆæœ¬: $(uname -r)"
    echo "ä¸»æ©Ÿåç¨±: $(hostname)"
    echo "ç³»çµ±é‹è¡Œæ™‚é–“: $(uptime -p)"
    echo
    
    # CPU è³‡è¨Š
    echo -e "${GREEN}ğŸ–¥ï¸  CPU è³‡è¨Š:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "CPU å‹è™Ÿ: $(lscpu | grep "Model name" | cut -d: -f2 | xargs)"
    echo "CPU æ ¸å¿ƒæ•¸: $(nproc)"
    echo "CPU ä½¿ç”¨ç‡:"
    top -bn1 | grep "Cpu(s)" | sed "s/.*, *\([0-9.]*\)%* id.*/\1/" | awk '{print "  ä½¿ç”¨ä¸­: " 100-$1 "% | é–’ç½®: " $1 "%"}'
    echo
    
    # è¨˜æ†¶é«”è³‡è¨Š
    echo -e "${GREEN}ğŸ§  è¨˜æ†¶é«”è³‡è¨Š:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    free -h | awk '
    NR==1{print "é¡å‹\t\tç¸½è¨ˆ\t\tå·²ä½¿ç”¨\t\tå¯ç”¨\t\tä½¿ç”¨ç‡"}
    NR==2{
        total=$2; used=$3; available=$7;
        if($2~/G/) {total_gb=total} else {total_gb=total/1024}
        if($3~/G/) {used_gb=used} else {used_gb=used/1024}
        if($7~/G/) {avail_gb=available} else {avail_gb=available/1024}
        printf "è¨˜æ†¶é«”\t\t%s\t\t%s\t\t%s\t\t%.1f%%\n", total, used, available, (used_gb/total_gb)*100
    }'
    echo
    
    # ç£ç¢Ÿä½¿ç”¨æƒ…æ³
    echo -e "${GREEN}ğŸ’¾ ç£ç¢Ÿä½¿ç”¨æƒ…æ³:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    df -h | grep -E '^/dev/' | awk '{
        printf "%-20s %8s %8s %8s %8s %s\n", $1, $2, $3, $4, $5, $6
    }' | head -1
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    df -h | grep -E '^/dev/' | awk '{
        printf "%-20s %8s %8s %8s %8s %s\n", $1, $2, $3, $4, $5, $6
    }' | tail -n +2
    echo
    
    # ç³»çµ±è² è¼‰
    echo -e "${GREEN}âš¡ ç³»çµ±è² è¼‰:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    uptime | awk -F'load average:' '{print "å¹³å‡è² è¼‰:" $2}'
    echo
    
    # ç¶²è·¯ä»‹é¢
    echo -e "${GREEN}ğŸŒ ç¶²è·¯ä»‹é¢:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | while read ip; do
        interface=$(ip route get $ip | grep -oP '(?<=dev\s)\w+' | head -1)
        echo "ä»‹é¢: $interface | IP: $ip"
    done
    echo
    
    # æ´»èºçš„ç¶²è·¯é€£æ¥
    echo -e "${GREEN}ğŸ”— æ´»èºé€£æ¥ (å‰10å€‹):${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    netstat -tuln 2>/dev/null | head -11 || ss -tuln | head -11
    echo
    
    read -p "æŒ‰ä»»æ„éµè¿”å›ä¸»èœå–®..." -n1 -s
}

# æª¢æŸ¥ speedtest-cli æ˜¯å¦å®‰è£
check_speedtest() {
    if ! command -v speedtest-cli &> /dev/null; then
        echo -e "${YELLOW}speedtest-cli æœªå®‰è£ï¼Œæ­£åœ¨å®‰è£...${NC}"
        if command -v apt &> /dev/null; then
            sudo apt update && sudo apt install -y speedtest-cli
        elif command -v yum &> /dev/null; then
            sudo yum install -y speedtest-cli
        elif command -v pip3 &> /dev/null; then
            pip3 install speedtest-cli
        else
            echo -e "${RED}ç„¡æ³•è‡ªå‹•å®‰è£ speedtest-cliï¼Œè«‹æ‰‹å‹•å®‰è£${NC}"
            return 1
        fi
    fi
    return 0
}

# ç¶²è·¯é€Ÿåº¦æ¸¬è©¦
network_speed_test() {
    show_header
    echo -e "${BLUE}=== ç¶²è·¯é€Ÿåº¦æ¸¬è©¦ ===${NC}"
    echo
    
    if ! check_speedtest; then
        echo
        read -p "æŒ‰ä»»æ„éµè¿”å›ä¸»èœå–®..." -n1 -s
        return
    fi
    
    echo -e "${YELLOW}æ­£åœ¨æ¸¬è©¦ç¶²è·¯é€Ÿåº¦ï¼Œè«‹ç¨å€™...${NC}"
    echo -e "${CYAN}é€™å¯èƒ½éœ€è¦å¹¾åˆ†é˜æ™‚é–“${NC}"
    echo
    
    # é¡¯ç¤ºæ¸¬è©¦é€²åº¦
    echo -e "${YELLOW}æ­£åœ¨é¸æ“‡æœ€ä½³æ¸¬è©¦ä¼ºæœå™¨...${NC}"
    
    # åŸ·è¡Œé€Ÿåº¦æ¸¬è©¦
    speedtest_result=$(speedtest-cli --simple 2>/dev/null)
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}âœ“ ç¶²è·¯é€Ÿåº¦æ¸¬è©¦å®Œæˆï¼${NC}"
        echo
        echo -e "${BLUE}ğŸ“Š æ¸¬è©¦çµæœ:${NC}"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # è§£æçµæœ
        ping=$(echo "$speedtest_result" | grep "Ping:" | awk '{print $2 " " $3}')
        download=$(echo "$speedtest_result" | grep "Download:" | awk '{print $2 " " $3}')
        upload=$(echo "$speedtest_result" | grep "Upload:" | awk '{print $2 " " $3}')
        
        echo -e "${CYAN}å»¶é² (Ping):     ${YELLOW}$ping${NC}"
        echo -e "${CYAN}ä¸‹è¼‰é€Ÿåº¦:        ${GREEN}$download${NC}"
        echo -e "${CYAN}ä¸Šå‚³é€Ÿåº¦:        ${GREEN}$upload${NC}"
        echo
        
        # é€Ÿåº¦è©•ä¼°
        download_mbps=$(echo "$download" | awk '{print $1}')
        if (( $(echo "$download_mbps > 100" | bc -l) )); then
            echo -e "${GREEN}ğŸš€ ç¶²è·¯é€Ÿåº¦å¾ˆæ£’ï¼${NC}"
        elif (( $(echo "$download_mbps > 50" | bc -l) )); then
            echo -e "${YELLOW}âš¡ ç¶²è·¯é€Ÿåº¦è‰¯å¥½${NC}"
        elif (( $(echo "$download_mbps > 25" | bc -l) )); then
            echo -e "${YELLOW}ğŸ“¶ ç¶²è·¯é€Ÿåº¦æ™®é€š${NC}"
        else
            echo -e "${RED}ğŸŒ ç¶²è·¯é€Ÿåº¦è¼ƒæ…¢${NC}"
        fi
        
        echo
        echo -e "${BLUE}æ˜¯å¦è¦ä¿å­˜æ¸¬è©¦çµæœåˆ°æ–‡ä»¶ï¼Ÿ${NC}"
        read -p "[y/N]: " save_result
        if [[ $save_result =~ ^[Yy]$ ]]; then
            timestamp=$(date "+%Y-%m-%d_%H-%M-%S")
            result_file="speedtest_result_$timestamp.txt"
            {
                echo "ç¶²è·¯é€Ÿåº¦æ¸¬è©¦çµæœ"
                echo "æ¸¬è©¦æ™‚é–“: $(date)"
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo "$speedtest_result"
            } > "$result_file"
            echo -e "${GREEN}âœ“ çµæœå·²ä¿å­˜åˆ°: $result_file${NC}"
        fi
    else
        echo -e "${RED}âœ— ç¶²è·¯é€Ÿåº¦æ¸¬è©¦å¤±æ•—${NC}"
        echo -e "${YELLOW}è«‹æª¢æŸ¥ç¶²è·¯é€£æ¥å¾Œé‡è©¦${NC}"
    fi
    
    echo
    read -p "æŒ‰ä»»æ„éµè¿”å›ä¸»èœå–®..." -n1 -s
}

# ç³»çµ±è³‡è¨Šç¸½è¦½
system_overview() {
    show_header
    echo -e "${BLUE}=== ç³»çµ±è³‡è¨Šç¸½è¦½ ===${NC}"
    echo
    
    # å¿«é€Ÿå¥åº·æª¢æŸ¥
    echo -e "${GREEN}ğŸ¥ ç³»çµ±å¥åº·æª¢æŸ¥:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    
    # æª¢æŸ¥ç£ç¢Ÿç©ºé–“
    disk_usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
    if [ "$disk_usage" -gt 90 ]; then
        echo -e "${RED}âš ï¸  ç£ç¢Ÿç©ºé–“: ${disk_usage}% (è­¦å‘Š: ç©ºé–“ä¸è¶³)${NC}"
    elif [ "$disk_usage" -gt 80 ]; then
        echo -e "${YELLOW}âš ï¸  ç£ç¢Ÿç©ºé–“: ${disk_usage}% (æ³¨æ„: ç©ºé–“åä½)${NC}"
    else
        echo -e "${GREEN}âœ“ ç£ç¢Ÿç©ºé–“: ${disk_usage}% (æ­£å¸¸)${NC}"
    fi
    
    # æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨
    mem_usage=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    if [ "$mem_usage" -gt 90 ]; then
        echo -e "${RED}âš ï¸  è¨˜æ†¶é«”ä½¿ç”¨: ${mem_usage}% (è­¦å‘Š: ä½¿ç”¨ç‡éé«˜)${NC}"
    elif [ "$mem_usage" -gt 80 ]; then
        echo -e "${YELLOW}âš ï¸  è¨˜æ†¶é«”ä½¿ç”¨: ${mem_usage}% (æ³¨æ„: ä½¿ç”¨ç‡åé«˜)${NC}"
    else
        echo -e "${GREEN}âœ“ è¨˜æ†¶é«”ä½¿ç”¨: ${mem_usage}% (æ­£å¸¸)${NC}"
    fi
    
    # æª¢æŸ¥ç³»çµ±è² è¼‰
    load_avg=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | sed 's/,//')
    cpu_cores=$(nproc)
    load_percentage=$(echo "scale=0; $load_avg * 100 / $cpu_cores" | bc)
    
    if [ "$load_percentage" -gt 100 ]; then
        echo -e "${RED}âš ï¸  ç³»çµ±è² è¼‰: ${load_avg} (è­¦å‘Š: è² è¼‰éé«˜)${NC}"
    elif [ "$load_percentage" -gt 80 ]; then
        echo -e "${YELLOW}âš ï¸  ç³»çµ±è² è¼‰: ${load_avg} (æ³¨æ„: è² è¼‰åé«˜)${NC}"
    else
        echo -e "${GREEN}âœ“ ç³»çµ±è² è¼‰: ${load_avg} (æ­£å¸¸)${NC}"
    fi
    
    echo
    
    # å¿«é€Ÿçµ±è¨ˆ
    echo -e "${GREEN}ğŸ“ˆ å¿«é€Ÿçµ±è¨ˆ:${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo "ç³»çµ±å•Ÿå‹•æ™‚é–“: $(uptime -s)"
    echo "é‹è¡Œæ™‚é–“: $(uptime -p)"
    echo "ç•¶å‰ç”¨æˆ¶: $(whoami)"
    echo "ç™»å…¥ç”¨æˆ¶æ•¸: $(who | wc -l)"
    echo "é‹è¡Œé€²ç¨‹æ•¸: $(ps aux | wc -l)"
    echo
    
    # å‰5å€‹æ¶ˆè€—CPUçš„é€²ç¨‹
    echo -e "${GREEN}ğŸ” CPU ä½¿ç”¨ç‡æœ€é«˜çš„é€²ç¨‹ (å‰5å€‹):${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    ps aux --sort=-%cpu | awk 'NR==1{print "USER\t\tPID\t%CPU\t%MEM\tCOMMAND"} NR>=2&&NR<=6{printf "%-12s\t%s\t%s\t%s\t%s\n", $1, $2, $3, $4, $11}'
    echo
    
    # å‰5å€‹æ¶ˆè€—è¨˜æ†¶é«”çš„é€²ç¨‹
    echo -e "${GREEN}ğŸ§  è¨˜æ†¶é«”ä½¿ç”¨é‡æœ€é«˜çš„é€²ç¨‹ (å‰5å€‹):${NC}"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    ps aux --sort=-%mem | awk 'NR==1{print "USER\t\tPID\t%CPU\t%MEM\tCOMMAND"} NR>=2&&NR<=6{printf "%-12s\t%s\t%s\t%s\t%s\n", $1, $2, $3, $4, $11}'
    echo
    
    read -p "æŒ‰ä»»æ„éµè¿”å›ä¸»èœå–®..." -n1 -s
}

# ä¸»ç¨‹åº
main() {
    while true; do
        show_header
        show_menu
        read -r choice
        
        case $choice in
            1)
                cleanup_docker_images
                ;;
            2)
                system_status
                ;;
            3)
                network_speed_test
                ;;
            4)
                system_overview
                ;;
            0)
                echo -e "${GREEN}æ„Ÿè¬ä½¿ç”¨ Ubuntu å·¥å…·ç®±ï¼${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}ç„¡æ•ˆçš„é¸é …ï¼Œè«‹é‡æ–°é¸æ“‡${NC}"
                sleep 2
                ;;
        esac
    done
}

# æª¢æŸ¥æ˜¯å¦ç‚º root ç”¨æˆ¶ (æŸäº›åŠŸèƒ½å¯èƒ½éœ€è¦)
if [[ $EUID -eq 0 ]]; then
    echo -e "${YELLOW}æ³¨æ„: æ‚¨æ­£åœ¨ä»¥ root ç”¨æˆ¶èº«ä»½é‹è¡Œæ­¤å·¥å…·${NC}"
    echo -e "${YELLOW}æŸäº›åŠŸèƒ½å¯èƒ½éœ€è¦æ™®é€šç”¨æˆ¶æ¬Šé™${NC}"
    echo
fi

# å•Ÿå‹•ä¸»ç¨‹åº
main
